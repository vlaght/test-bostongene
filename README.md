# Микросервис по обсчету md5-сумм для загруженных файлов

## Как запустить?
### ! Для корректной работы rest и worker должны быть либо оба вне докера, либо оба в нём

Сначала сбилдить образ, запустить базу и redis, после чего запустить API:
```sh
docker compose build
docker compose up -d db redis
docker compose up rest
```

Последовательно стоит запускать чтобы дать СУБД проинититься, иначе к ней постучатся ранее чем она наведет марафет и субъект отвалится.
Контейнеры замаунтят media/ в текущей папке, куда будут складываться загруженные файлики

Стучаться к API на `localhost:8000/`
Генерированная дока доступна на `localhost:8000/docs`, там описание что-как

## Как добавить воркеров?

В этой реализации просто копипастить сервис `worker1`, давая ему новое имя и дописывая в секцию `depends_on` сервиса `rest` (если не хочется запускать вручную). После этого поднимать воркеров следует ПОСЛЕДОВАТЕЛЬНО, чтобы они корректно синхронились между собой. Ну или можно их последовательно зацеплять как связный список через depends_on, и хвост этого списка цеплять уже в `depends_on` сервиса `rest`, только надо им всем некоторую задержку поставить, ибо композ их пустит в одно время примерно, и будут ошибки при синхронизации

## А если rest без докера?

Тогда нужен python3.9, любой venv-менеджер (у меня вот conda) на ваш выбор и следующие телодвижения:
```sh
conda create -n bostongene python=3.9
conda activate bostongene
pip install poetry
poetry install
uvicorn rest:app --reload
```

А worker-а celery в том же виртуальном окружении:
```sh
celery -A celery_app worker --loglevel=INFO
```

